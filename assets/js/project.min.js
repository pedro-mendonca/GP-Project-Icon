jQuery(document).ready(function($){var userLocale=gpToolbox.user_locale,supportedTranslationStatuses=gpToolbox.supported_statuses,tableTranslationSets=$("table.gp-table.translation-sets"),glotpressAdmin=gpToolbox.admin,gpUrlProject=gpToolbox.gp_url_project,project=gpToolbox.args.project,dataPrefix="gptoolboxdata-",highlightCounts=!1;function updateHighlight(element){!1!==highlightCounts&&(element?"0"===$(element).find("a").text()?$(element).removeClass("highlight"):$(element).addClass("highlight"):$(tableTranslationSets).find("td.stats").each(function(){"0"===$(this).find("a").text()?($(this).removeClass("highlight"),$(this).find("button.delete").hide().attr("disabled",!0)):$(this).addClass("highlight")}))}function translationsBulkDelete(locale,slug,status){var td=$(tableTranslationSets).find('tbody tr[gptoolboxdata-locale="'+locale+'"]['+dataPrefix+'slug="'+slug+'"] td.stats.'+status),notice=$(td).find("div.progress-notice"),stats=$(td).find("a.count"),button=$(td).find("button.delete");$(stats).hide(),$(button).hide().attr("disabled",!0),$(notice).text(wp.i18n.__("Deleting...","gp-project-icon")).fadeIn(),$.ajax({url:wpApiSettings.root+"gp-project-icon/v1/translations/"+project.path+"/"+locale+"/"+slug+"/"+status+"/-delete",type:"POST",data:{_wpnonce:gpToolbox.nonce},success:function(response){var count=null;"old"===status?count=response.stats.old:"rejected"===status&&(count=response.stats.rejected),$(stats).text(new Intl.NumberFormat(userLocale.slug).format(count)),$(td).attr("data-text",count),updateHighlight(td)},error:function(response){},complete:function(){$(notice).hide().text(""),$(stats).fadeIn()}})}"1"===gpToolbox.highlight_counts&&(highlightCounts=!0),tableTranslationSets.length&&(supportedTranslationStatuses.hasOwnProperty("old")&&$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-old">'+wp.i18n.__("Old","gp-project-icon")+"</td>"),supportedTranslationStatuses.hasOwnProperty("rejected")&&$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-rejected">'+wp.i18n.__("Rejected","gp-project-icon")+"</td>"),supportedTranslationStatuses.hasOwnProperty("changesrequested")&&$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-changesrequested">'+wp.i18n.__("Changes requested","gp-project-icon")+"</td>"),$(tableTranslationSets).children("thead").children("tr").find("th:last").after('<th class="gptoolbox-column-warnings">'+wp.i18n.__("Warnings","gp-project-icon")+"</td>"),$(tableTranslationSets).children("tbody").children("tr").each(function(){supportedTranslationStatuses.hasOwnProperty("old")&&$(this).find("td:last").after('<td class="stats old"></td>'),supportedTranslationStatuses.hasOwnProperty("rejected")&&$(this).find("td:last").after('<td class="stats rejected"></td>'),supportedTranslationStatuses.hasOwnProperty("changesrequested")&&$(this).find("td:last").after('<td class="stats changesrequested"></td>'),$(this).find("td:last").after('<td class="stats warnings"></td>'),$(this).children("td:first-child").find("a").each(function(){var regexPattern=new RegExp("^"+gpUrlProject+".*"+project.path+"/(.*)/(.*)/$"),regexPattern=$(this).attr("href").match(regexPattern),locale=regexPattern[1],regexPattern=regexPattern[2];$(this).closest("tr").attr(dataPrefix+"locale",locale),$(this).closest("tr").attr(dataPrefix+"slug",regexPattern),$(this).closest("tr").attr(dataPrefix+"projectpath",project.path)})}),$(tableTranslationSets).children("tbody").children("tr").each(function(){var locale=$(this).attr("gptoolboxdata-locale"),translationSet=gpToolbox.args.translation_sets[locale],locale=$(this).children("td:first-child").find("a").attr("href"),old=$(this).children("td.stats.old"),rejected=$(this).children("td.stats.rejected");supportedTranslationStatuses.hasOwnProperty("old")&&$(this).find("td.stats.old").attr("data-text",translationSet.old_count).html('<div class="progress-notice" style="display: none;"></div><a class="count" href="'+locale+'?filters[status]=old">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.old_count)+"</a>"),supportedTranslationStatuses.hasOwnProperty("rejected")&&$(this).find("td.stats.rejected").attr("data-text",translationSet.rejected_count).html('<div class="progress-notice" style="display: none;"></div><a class="count" href="'+locale+'?filters[status]=rejected">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.rejected_count)+"</a>"),supportedTranslationStatuses.hasOwnProperty("changesrequested")&&$(this).find("td.stats.changesrequested").attr("data-text",translationSet.changesrequested_count).html('<a class="count" href="'+locale+'?filters[status]=changesrequested">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.changesrequested_count)+"</a>"),$(this).find("td.stats.warnings").attr("data-text",translationSet.warnings_count).html('<div class="progress-notice" style="display: none;"></div><a class="count" href="'+locale+'?filters[warnings]=yes">'+new Intl.NumberFormat(userLocale.slug).format(translationSet.warnings_count)+"</a>"),glotpressAdmin&&($(old).find("a.count").after('<button class="delete hidden" disabled><span class="dashicons dashicons-trash"></span></button>'),$(rejected).find("a.count").after('<button class="delete hidden" disabled><span class="dashicons dashicons-trash"></span></button>'),"0"!==$(old).find("a.count").text().trim()&&$(old).find("button.delete").attr("disabled",!1).removeClass("hidden"),"0"!==$(rejected).find("a.count").text().trim()&&$(rejected).find("button.delete").attr("disabled",!1).removeClass("hidden"),$(old).find("button.delete").on("click",function(){confirm(wp.i18n.__("You are about to permanently delete these translations.\nThis action cannot be undone.\n'Cancel' to stop, 'OK' to delete.","gp-project-icon"))&&translationsBulkDelete(translationSet.locale,translationSet.slug,"old")}),$(rejected).find("button.delete").on("click",function(){confirm(wp.i18n.__("You are about to permanently delete these translations.\nThis action cannot be undone.\n'Cancel' to stop, 'OK' to delete.","gp-project-icon"))&&translationsBulkDelete(translationSet.locale,translationSet.slug,"rejected")}))}),updateHighlight(),wp.hooks.addAction("gpToolboxUpdateHighlight","update_highlight_action",function(element){updateHighlight(element)}))});